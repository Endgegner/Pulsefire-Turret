<?xml version="1.0" encoding="UTF-8"?>
<Patch>
  
  <!-- Mod Support for Combat Extended -->
  <Operation Class="PatchOperationFindMod">
	<mods>
		<li>Combat Extended</li>
	</mods>
	<match Class="PatchOperationSequence">
		<success>Always</success>
		<operations>
			<!-- Compatibility for Turret -->
			<li Class="PatchOperationReplace">
				<xpath>*/ThingDef[defName="PulsefireTurretGun"]</xpath>
				<value>
					<ThingDef ParentName="BuildingBase">
						<defName>PulsefireTurretGun</defName>
						<label>Pulsefire Turret</label>
						<thingClass>CombatExtended.Building_TurretGunCE</thingClass>
						<graphicData>
							<texPath>Things/Building/Security/PulsefireTurretBase</texPath>
							<shaderType>CutoutComplex</shaderType>
							<graphicClass>Graphic_Single</graphicClass>
							<drawSize>(2,2)</drawSize>
							<damageData>
								<rect>(0.2,0.2,0.6,0.6)</rect>
							</damageData>
						</graphicData>
						<castEdgeShadows>true</castEdgeShadows>
						<minifiedDef>MinifiedThing</minifiedDef>
						<uiIconPath>Things/Building/Security/PulsefireTurretGun_Ico</uiIconPath>
						<altitudeLayer>Building</altitudeLayer>
						<pathCost>50</pathCost>
						<statBases>
							<MaxHitPoints>175</MaxHitPoints>
							<Flammability>0.25</Flammability>
							<WorkToBuild>3000</WorkToBuild>
							<Mass>120</Mass>
							<Beauty>-15</Beauty>
							<AimingAccuracy>0.91</AimingAccuracy>
							<ShootingAccuracyTurret>0.89</ShootingAccuracyTurret>
						</statBases>
						<tickerType>Normal</tickerType>
						<comps Inherit="False">
							<li Class="CompProperties_Explosive">
								<explosiveRadius>1</explosiveRadius>
								<explosiveDamageType>Bomb</explosiveDamageType>
								<chanceNeverExplodeFromDamage>0.8</chanceNeverExplodeFromDamage>
							</li>
							<li Class="CompProperties_Forbiddable"/>
							<li Class="CompProperties_Power">
								<compClass>CompPowerTrader</compClass>
								<basePowerConsumption>400</basePowerConsumption>
							</li>
							<li Class="CompProperties_Flickable"/>
							<li Class="CompProperties_Breakdownable"/>
						</comps>
						<description>A turret with a Pulsefire rifle on top that automtically fires at nearby and distant enemies. Has a chance to explode when damaged.</description>
						<passability>PassThroughOnly</passability>
						<fillPercent>0.85</fillPercent>
						<hasTooltip>true</hasTooltip>
						<thingCategories>
							<li>BuildingsSecurity</li>
						</thingCategories>
						<stuffCategories>
							<li>Metallic</li>
						</stuffCategories>
						<costStuffCount>125</costStuffCount>
						<costList>
							<Steel>125</Steel>
							<ComponentIndustrial>8</ComponentIndustrial>
						</costList>
						<constructionSkillPrerequisite>5</constructionSkillPrerequisite>
						<terrainAffordanceNeeded>Light</terrainAffordanceNeeded>
						<designationCategory>Security</designationCategory>
						<designationHotKey>Misc5</designationHotKey>
						<specialDisplayRadius>56</specialDisplayRadius>
						<stealable>false</stealable>
						<rotatable>true</rotatable>
						<building>
							<ai_combatDangerous>true</ai_combatDangerous>
							<turretGunDef>Gun_PulsefireTurret</turretGunDef>
							<turretBurstCooldownTime>6.0</turretBurstCooldownTime>
							<turretTopGraphicPath>Things/Building/Security/PulsefireTurretGun</turretTopGraphicPath>
						</building>
						<placeWorkers>
							<li>PlaceWorker_TurretTop</li>
						</placeWorkers>
						<researchPrerequisites>
							<li>PulsefireTech</li>
						</researchPrerequisites>
					</ThingDef>
				</value>
			</li>
			<li Class="PatchOperationReplace">
				<xpath>*/ThingDef[defName="Gun_PulsefireTurret"]</xpath>
				<value>
					<ThingDef ParentName="BaseHumanGun">
						<defName>Gun_PulsefireTurret</defName>
						<label>Pulsefire Turret</label>
						<menuHidden>true</menuHidden>
						<description>Base defense turret for military outposts. Has a direct impact rifle with Pulsefire technology attached to it. Maximum range, great accuracy and full metal jacket power mounted on an auto turret.</description>
						<graphicData>
							<texPath>Things/Building/Security/PulsefireTurretBase</texPath>
							<graphicClass>Graphic_Single</graphicClass>
						</graphicData>
						<soundInteract>Interact_Rifle</soundInteract>
						<tradeability>None</tradeability>
						<destroyOnDrop>true</destroyOnDrop>
						<statBases>
						  <SightsEfficiency>0.93</SightsEfficiency>
						  <ShotSpread>0.01</ShotSpread>
						  <SwayFactor>0.25</SwayFactor>
						  <Bulk>18.05</Bulk>
						  <Mass>15.50</Mass>
						  <RangedWeapon_Cooldown>3</RangedWeapon_Cooldown>
						</statBases>
						<weaponTags>
							<li>TurretGun</li>
						</weaponTags>
						<verbs>
						  <li Class="CombatExtended.VerbPropertiesCE">
							<recoilAmount>0.79</recoilAmount>
							<verbClass>CombatExtended.Verb_ShootCE</verbClass>
							<hasStandardCommand>true</hasStandardCommand>
							<defaultProjectile>Bullet_600NitroExpress_FMJ</defaultProjectile>
							<warmupTime>1.25</warmupTime>
							<range>75</range>
							<ticksBetweenBurstShots>6</ticksBetweenBurstShots>
							<burstShotCount>1</burstShotCount>
							<soundCast>PulsefireTurretRound</soundCast>
							<muzzleFlashScale>9</muzzleFlashScale>
							<targetParams>
							  <canTargetLocations>false</canTargetLocations>
							</targetParams>
							<recoilPattern>Mounted</recoilPattern>
						  </li>
						</verbs>
						<comps>
							<li Class="CombatExtended.CompProperties_AmmoUser">
								<magazineSize>50</magazineSize>
								<reloadTime>8.5</reloadTime>
								<ammoSet>AmmoSet_600NitroExpress</ammoSet>
							</li>
							<li Class="CombatExtended.CompProperties_FireModes">
								<aiUseBurstMode>FALSE</aiUseBurstMode>
								<aiAimMode>AimedShot</aiAimMode>
								<aimedBurstShotCount>1</aimedBurstShotCount>
								<noSnapshot>true</noSnapshot>
								<noSingleShot>true</noSingleShot>
							</li>
						</comps>	
					</ThingDef>
				</value>
			</li>
		</operations>
	</match>
  </Operation>

</Patch>